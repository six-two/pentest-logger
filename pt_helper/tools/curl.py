# local files
from pt_helper import ParamManipulator, ParamInfo, Settings, BaseToolWrapper, Param
from pt_helper.utils import HOSTNAME, IP_ADDRESS

# -h is short for --header
FLAG_BLOCKLIST = ["-V", "--version", "-h", "--help"]

PARAMS = {
    # curl --help all|grep proxy
    # -x, --proxy [protocol://]host[:port]  Use this proxy
    Param.Proxy: ParamInfo("--proxy", ["-x"]),
    # -A, --user-agent <name>  Send User-Agent <name> to server
    Param.UserAgent: ParamInfo("--user-agent", ["-A"]),
}

# There are way to many output options to check for them all

TARGET_PATTERN_LIST = [
    # Protocol? + Host + Port? + Path?
    r"(https://)?"
    + f"({HOSTNAME}|{IP_ADDRESS})"
    + r"(:\d{1,5})?"
    + r"(\/.*)?"
]


class Curl(BaseToolWrapper):
    def __init__(self, settings: Settings) -> None:
        super().__init__(settings, FLAG_BLOCKLIST, PARAMS, TARGET_PATTERN_LIST)
